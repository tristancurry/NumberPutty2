<html>
<!-- NumberPutty 2 2017 -->
<head></head>


<body>


<canvas id="viewport" width="500" height="500" style="position:absolute; top:0px; left:0px; z-index:1; border-style:inset; border-color:#FF0000; border-width:5px;"></canvas>
<canvas id="viewport2" width="500" height="500" style="position:absolute; top:0px; left:0px; z-index:0; border-style:inset; border-color:#FF0000; border-width:5px;"></canvas>
<button type="button" id="oneMore" style="z-index:2; position:absolute; top:20px; left:20px;" onclick="help()">One more</button>
<script src="physicsjs/physicsjs-full.min.js"></script>

<script>
   var requestAnimationFrame = window.requestAnimationFrame || 
                            window.mozRequestAnimationFrame || 
                            window.webkitRequestAnimationFrame || 
                            window.msRequestAnimationFrame;
   

var mainCanvas = document.querySelector("#viewport2");
var mainContext = mainCanvas.getContext("2d");

	var width = mainCanvas.width;
	var height = mainCanvas.height;

// left: 37, up: 38, right: 39, down: 40,
// spacebar: 32, pageup: 33, pagedown: 34, end: 35, home: 36
var keys = {37: 1, 38: 1, 39: 1, 40: 1};

function preventDefault(e) {
  e = e || window.event;
  if (e.preventDefault)
      e.preventDefault();
  e.returnValue = false;  
}

function preventDefaultForScrollKeys(e) {
    if (keys[e.keyCode]) {
        preventDefault(e);
        return false;
    }
}

function disableScroll() {
  if (window.addEventListener) // older FF
      window.addEventListener('DOMMouseScroll', preventDefault, false);
  window.onwheel = preventDefault; // modern standard
  window.onmousewheel = document.onmousewheel = preventDefault; // older browsers, IE
  window.ontouchmove  = preventDefault; // mobile
  document.onkeydown  = preventDefaultForScrollKeys;
}

function enableScroll() {
    if (window.removeEventListener)
        window.removeEventListener('DOMMouseScroll', preventDefault, false);
    window.onmousewheel = document.onmousewheel = null; 
    window.onwheel = null; 
    window.ontouchmove = null;  
    document.onkeydown = null;  
}
Physics(function( world ){

	function drawBlob(nB, ctx){
	ctx.save();
	ctx.fillStyle = "rgba(100,100,100,0.5)";
	ctx.translate(nB.state.pos.x,nB.state.pos.y);
	ctx.rotate(nB.state.angular.pos);
	ctx.beginPath();
	ctx.arc(0,0,nB.radius,0,2*Math.PI);
	ctx.fill();
	ctx.stroke();
	ctx.fillStyle = "black";
	ctx.font = "20px Arial";
	ctx.textAlign = "center";
	ctx.textBaseline = "middle";
	ctx.fillText(nB.value, 0,0);
	ctx.restore();
	
	
	}

   
	var bounds = Physics.aabb(0, 0, 500, 500);
	var clicks = 0;
	
	
	Physics.body('numberBlob', 'circle', function( parent ){
	
    return {
	

		};
	});

   help = function(){

	   clicks++;
	   world.add( Physics.body('numberBlob', {
			x: 12,
			y: 12,
			vx: 0.05,
			radius: 30,
			restitution: 0.9,
			mass:10,
			value: 1
		} ))
	console.log("pressed " + clicks + " times");

   }
	

	

   
	var renderer = Physics.renderer('canvas', {
		autoResize: false,
		el: 'viewport', // id of the canvas element
		width: 500,
		height: 500,
	});
	
	world.add( renderer ); 

	

   
	var blobulon = Physics.body('numberBlob', {
		x: 250,
		y: 250,
		vx: 0.05,
		radius: 30,
		value: Math.round(100*Math.random()),
		restitution: 1.0,
		cof: 0,
		mass:10
	});
	

	(function(){
	do {
	world.add( Physics.body('numberBlob', {
		x: 250,
		y: 250,
		vx: 0.05,
		value: Math.round(100*Math.random()),
		radius: 20,
		restitution: 0.3,
		cof: 0.8,
		mass:10
	
	}))} while (world._bodies.length < 20);
	})();
	
	
	world.add( blobulon );
	
	
	
		world.add( Physics.behavior('edge-collision-detection', {
		aabb: bounds,
		restitution: 1  //default is 1.0 for perfectly elastic collision 
	}) );
	// ensure objects bounce when edge collision is detected
	world.add( Physics.behavior('body-impulse-response') );
	world.add( Physics.behavior('constant-acceleration') );
	world.add( Physics.behavior('body-collision-detection') );
	world.add( Physics.behavior('sweep-prune') );
	world.add( Physics.behavior('interactive', { el: renderer.el }));
	

	/*world.render();

	world.on('step', function(){
		world.render();
	});
   
	Physics.util.ticker.on(function( time, dt ){
		world.step( time );
	});
	// start the ticker
	Physics.util.ticker.start();
*/

	//this will be the main rendering/updating/interface loop
	
	drawWorld = function(){
	mainContext.clearRect(0,0, width, height);
	for(n in world._bodies){
	drawBlob(world._bodies[n], mainContext);
	}
	world.step();
	console.log(world);
	requestAnimationFrame(drawWorld);
	}
	disableScroll();
	drawWorld();
});


</script>
</body>
</html>