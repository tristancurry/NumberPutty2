<html>
<!-- NumberPutty 2 2017 -->
<head></head>


<body>


<canvas id="viewport" width="500" height="500" style="position:absolute; top:0px; left:0px; z-index:-1; border-style:inset; border-color:#FF0000; border-width:5px;"></canvas>
<canvas id="viewport2" width="500" height="500" style="position:absolute; top:0px; left:0px; z-index:1; border-style:inset; border-color:#FF0000; border-width:5px;"></canvas>
<button type="button" id="oneMore" style="z-index:2; position:absolute; top:20px; left:20px;" onclick="help()">One more</button>
<script src="physicsjs/physicsjs-full.min.js"></script>

<script>
   var requestAnimationFrame = window.requestAnimationFrame || 
                            window.mozRequestAnimationFrame || 
                            window.webkitRequestAnimationFrame || 
                            window.msRequestAnimationFrame;
   

var mainCanvas = document.querySelector("#viewport2");
var mainContext = mainCanvas.getContext("2d");
   
   

   
Physics(function( world ){

	function drawBlob(nB, ctx){
	ctx.save();
	ctx.fillStyle = "rgba(100,100,100,0.5)";
	ctx.translate(nB.x,nB.y);
	ctx.arc(0,0,50,0,2*Math.PI);
	ctx.fillStyle = "black";
	ctx.font = "20px Arial";
	ctx.fillText(nB.value, 0,0);
	ctx.restore();
	
	
	}

   
	var bounds = Physics.aabb(0, 0, 500, 500);
	var clicks = 0;
	
	
	Physics.body('numberBlob', 'circle', function( parent ){
	
	

    return {
	
		

		};
	});

   help = function(){

	   clicks++;
	   world.add( Physics.body('numberBlob', {
			x: 12,
			y: 12,
			vx: 0.05,
			radius: 25,
			restitution: 0.9,
			mass:10,
			value: Math.random()
		} ))
	console.log("pressed " + clicks + " times");

   }
	

	

   
	var renderer = Physics.renderer('canvas', {
		autoResize: false,
		el: 'viewport', // id of the canvas element
		width: 500,
		height: 500,
		styles: {

   'circle' : {
       strokeStyle: '#542437',
       lineWidth: 1,
       fillStyle: '#542437',
       angleIndicator: 'none'
   },

   'convex-polygon' : {
       strokeStyle: '#542437',
       lineWidth: 1,
       fillStyle: '#542437',
       angleIndicator: 'white'
   }
}

	});
	
	world.add( renderer ); 


	world.add( Physics.body('convex-polygon', {
		x: 250,
		y: 50,
		vx: 0.05,
		restitution: 0.3,
		vertices: [
			{x: 0, y: 80},
			{x: 60, y: 40},
			{x: 60, y: -40},
			{x: 0, y: -80}
		]
	}) );

	world.add( Physics.body('convex-polygon', {
		x: 400,
		y: 200,
		vx: -0.02,
		restitution: 0.3,
		vertices: [
			{x: 0, y: 80},
			{x: 80, y: 0},
			{x: 0, y: -80},
			{x: -30, y: -30},
			{x: -30, y: 30}
		]
	}) );
	
   
	var blobulon = Physics.body('numberBlob', {
		x: 250,
		y: 250,
		vx: 0.05,
		radius: 30,
		value: Math.random(),
		restitution: 0.3,
		mass:10
	});
	

	
	world.add( blobulon );
	
	
		world.add( Physics.behavior('edge-collision-detection', {
		aabb: bounds,
		restitution: 0.6  //default is 1.0 for perfectly elastic collision 
	}) );
	// ensure objects bounce when edge collision is detected
	world.add( Physics.behavior('body-impulse-response') );
	world.add( Physics.behavior('constant-acceleration') );
	world.add( Physics.behavior('body-collision-detection') );
	world.add( Physics.behavior('sweep-prune') );
	world.add( Physics.behavior('interactive', { el: renderer.el }));
	

	/*world.render();

	world.on('step', function(){
		world.render();
	});
   
	Physics.util.ticker.on(function( time, dt ){
		world.step( time );
	});
	// start the ticker
	Physics.util.ticker.start();
*/

	//this will be the main rendering/updating/interface loop
	
	drawWorld = function(){
	drawBlob(blobulon, mainContext);
	world.step();
	requestAnimationFrame(drawWorld);
	}
	
	drawWorld(world);
});


</script>
</body>
</html>